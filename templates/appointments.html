<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointment Page</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='appointments.css') }}">
    <script>
        function onHomeClick() {
            window.location.href = "{{ url_for('home') }}";
        }
        function onMedicineClick() {
            window.location.href = "{{ url_for('medicines') }}";
        }
        function onOrderFoodClick(){
            window.location.href = "{{ url_for('foodordering') }}";
        }
        function onOrderClothClick(){
            window.location.href = "{{ url_for('clothes') }}";
        }
        function callSigninPage(){
            window.location.href = "{{ url_for('signin') }}";
        }
        function callAccountFlyer(){
            window.location.href = "{{ url_for('account') }}";
        }

        // Function to find clinics based on pincode
        function findClinics() {
            const pincode = document.getElementById('pincode').value;
            if (pincode.length === 6) {
                fetch(`/get_vets?pincode=${pincode}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        document.getElementById('clinics-list').innerHTML = '';
                        data.forEach(vet => {
                            const clinicCard = document.createElement('div');
                            clinicCard.className = 'clinic-card';
                            clinicCard.innerHTML = `
                                <h2>${vet.name}</h2>
                                <p>Address: ${vet.address}</p>
                                <p>Phone: ${vet.phone}</p>
                                <p>Rating: ${vet.rating}</p>
                                <button onclick="bookAppointment('${vet.name}', '${vet.address}')">Book Appointment</button>
                            `;
                            document.getElementById('clinics-list').appendChild(clinicCard);
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching clinic data:', error);
                        alert('Failed to load clinics. Please try again later.');
                    });
            } else {
                alert("Please enter a valid 6-digit pincode.");
            }
        }

        // Function to book an appointment
        function bookAppointment(clinicName, address) {
            const appointment = {
                name: clinicName,
                address: address,
                date: getFutureDate(2), // Get the date two days from now
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) // Current time
            };
            
            saveAppointment(appointment);
            
            // Inform the user that the appointment has been booked
            alert(`Appointment booked at ${clinicName} on ${appointment.date} at ${appointment.time}.`);
        }

        // Function to save the appointment to local storage
        function saveAppointment(appointment) {
            const appointments = JSON.parse(localStorage.getItem('appointments')) || [];
            appointments.push(appointment);
            localStorage.setItem('appointments', JSON.stringify(appointments));
        }

        // Function to load appointments from local storage
        function loadAppointments() {
            const appointments = JSON.parse(localStorage.getItem('appointments')) || [];
            const appointmentsList = document.getElementById('appointments-list');
            
            appointmentsList.innerHTML = ''; // Clear the list first

            if (appointments.length === 0) {
                appointmentsList.innerHTML = '<p>No appointments booked.</p>';
                return;
            }

            appointments.forEach(appointment => {
                const appointmentItem = document.createElement('div');
                appointmentItem.innerHTML = `
                    <p>${appointment.name} - ${appointment.address}</p>
                    <p>Date: ${appointment.date}, Time: ${appointment.time}</p>
                `;
                appointmentsList.appendChild(appointmentItem);
            });
        }

        // Function to get a future date
        function getFutureDate(days) {
            const today = new Date();
            today.setDate(today.getDate() + days); // Add the specified number of days
            return today.toLocaleDateString(); // Format the date
        }

        // Load appointments when the page is loaded
        document.addEventListener('DOMContentLoaded', loadAppointments);
    </script>
</head>
<body>
    <header>
        <button onclick="onHomeClick()" class="homebutton">PET-O-CARE</button>
        <div class="spacer"></div>
        <div>
            <button class="navbar-links" onclick="onMedicineClick()">Medicines</button>
            <button class="navbar-links" onclick="callAccountFlyer()">Appointments</button>
            <button class="navbar-links" onclick="onOrderFoodClick()">Foods</button>
            <button class="navbar-links" onclick="onOrderClothClick()">Clothes</button>
        </div>
        <div class="spacer"></div>
        <button onclick="callSigninPage()" class="signin">Log In</button>
        <button onclick="callAccountFlyer()" class="account">Account</button>
    </header>
    <div class="page-note">       
        <h1>Appointments Booking</h1>
        <p>Find the nearest vets for your pet's health.</p>
    </div>

    <section class="search-section">
        <label for="pincode">Enter Your Pincode:</label>
        <input type="text" id="pincode" placeholder="Enter your pincode">
        <button class="search-button" onclick="findClinics()">Find Clinics</button>
    </section>
    
    <section id="clinics-list" class="clinics-list"></section>

    <!-- Appointments Section -->
    <section id="appointments-section">
        <h2>Your Appointments</h2>
        <div id="appointments-list"></div>
    </section>
</body>
</html>
